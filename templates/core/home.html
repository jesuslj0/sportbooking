{% extends 'layout/base.html' %}

{% block title %}
    Home
{% endblock %}

{% block navbar_brand %}
    SportBooking
{% endblock %}

{% block content %}
<div>
    <div class="d-flex justify-content-center bg-opacity-50" style="background-color: #2d9ff0ae;">
        <div class="position-relative col-md-9 p-0 min-vh-25">
            {% load static %}
            <img src="{% static 'img/hero-tennis-court.jpg' %}"
                alt="Cancha de Tenis"
                class="img-fluid w-100"
                style="filter: brightness(0.7);">

            <div class="position-absolute top-0 start-0 translate-middle-y text-white p-3 p-md-4" style="top: 5%; left: 5%; width: 90%;">
                <h1 class="h3 h-md-2 mb-2">Sistema de reservas deportivas</h1>
                <p class="lead fs-5 fs-md-4 mb-3">Elige tu pista favorita y reserva en segundos.</p>
                <a href="{% url 'reservas:pistas' %}" class="btn btn-primary btn-sm">Ver pistas disponibles</a>
            </div>
        </div>
    </div>
    <div class="container mt-4 mb-4">
        <h4>Tus reservas</h4>
        {% if reservations %}
        <ul class="list-group"> 
            {% for reservation in reservations %}
            <li class="list-group-item" style="position: relative">
            <div class="d-flex" style="gap: 10px">
                <div class="text-primary"><strong>{{ reservation.schedule.court.name }}</strong></div>
                <div><strong>{{ reservation.date|date }}</strong></div> 
            </div>
            <strong>Inicio:</strong> {{ reservation.schedule.start_time|time:"H:i" }}<br>
            <strong>Fin:</strong> {{ reservation.schedule.end_time|time:"H:i" }}<br>
            <div style="position: absolute; top: 10px; right: 20px;">
                {% if reservation.status == 'confirmed' %}
                <span class="badge bg-success">Confirmada</span>
                {% elif reservation.status == 'pending' %}
                <span class="badge bg-warning text-dark">Pendiente</span>
                {% elif reservation.status == 'cancelled' %}
                <span class="badge bg-danger">Cancelada</span>
                {% else %}
                <span class="badge bg-secondary">Desconocido</span>
                {% endif %}
            </div>

            {% if reservation.status == 'confirmed' %}
            <button type="button" class="btn btn-sm btn-secondary mb-2 me-3" style="position: absolute; bottom: 8px; right: 20px;"
                data-bs-toggle="modal" data-bs-target="#cancelModal{{ reservation.id }}">
                Anular
            </button>
            {% else %}
            <a href="{% url 'reservas:cancel_reservation' reservation.id %}" style="position: absolute; bottom: 8px; right: 20px;"
            class="btn btn-sm btn-secondary mb-2 me-3">
            Anular
            </a>
            {% endif %}

            {% if reservation.status == 'confirmed' %}
            <div class="modal fade" id="cancelModal{{ reservation.id }}" tabindex="-1" aria-labelledby="cancelModalLabel{{ reservation.id }}" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                    <div class="modal-header bg-warning text-dark">
                        <h5 class="modal-title" id="cancelModalLabel{{ reservation.id }}">Confirmar cancelación</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                    </div>
                    <div class="modal-body">
                        Estás a punto de <strong>anular una reserva confirmada</strong>.<br>
                        <br>
                        <strong>{{ reservation.schedule.court.name }}</strong><br>
                        {{ reservation.date }} — {{ reservation.schedule.start_time|time:"H:i" }} a {{ reservation.schedule.end_time|time:"H:i" }}.
                        <br><br>
                        ¿Deseas continuar?
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">No</button>
                        <a href="{% url 'reservas:cancel_reservation' reservation.id %}" class="btn btn-danger">Sí, anular</a>
                    </div>
                    </div>
                </div>
            </div>
            {% endif %}
            </li>
            {% endfor %}
        </ul>
        {% else %}
        <p class="card-text">Aún no tienes reservas.</p>
        {% endif %}
    </div>
    <div class="container mt-4 mb-4">
        <h5>Pistas recurrentes</h5>
        {% if recurring_courts %}
        <ul class="list-group"> 
            {% for court in recurring_courts %}
            <li class="list-group-item" style="position: relative">
            <div class="d-flex justify-content-between" style="gap: 10px">
                <div class="text-primary"><strong>{{ court.name }}</strong> <span class="text-muted">{{ court.get_type_display }}</span></div>
                <div></div> 
                <a class="btn btn-primary btn-sm" href="{% url 'reservas:pista' court.id %}">Ver</a>
            </div>
            {% endfor %}
        </ul>
        {% else %}
        <p class="card-text">No tienes pistas recurrentes.</p>
        {% endif %}
    </div>
{% endblock %}